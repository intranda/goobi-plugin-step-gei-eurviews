<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="template/template.html"
	xmlns:x="http://myfaces.apache.org/tomahawk"
	xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites">

	<ui:param name="myPageTitle"
		value="#{msgs.plugin_Gei_WorldViews_ResourceDescription_Title}" />

	<ui:define name="breadcrumb">
		<intranda:breadcrumb label="#{msgs.startseite}" action="index"
			navId="a0" />
		<intranda:breadcrumb label="#{msgs.aktuelleSchritte}"
			action="#{AktuelleSchritteForm.paginator.returnToPreviousPage}" />
		<intranda:breadcrumb
			label="#{AktuelleSchritteForm.mySchritt.prozess.titel}"
			action="task_edit" />
		<intranda:breadcrumb label="#{myPageTitle}" noSeparator="#{true}" />
	</ui:define>

	<ui:define name="info">
	</ui:define>

	<ui:define name="content">
	
	<script type="text/javascript"
			src='template/js/plugins/tinymce/js/tinymce/tinymce.min.js'></script>
	
		<x:stylesheet media="screen" path="Gei_WorldViews.css" />

		<h:form id="myform" styleClass="form-horizontal form-bordered"
			prependId="false">

			<div class="row">
				<h:inputHidden id="rowIndex"
					value="#{AktuelleSchritteForm.myPlugin.index}" />
				<h:inputHidden id="rowType"
					value="#{AktuelleSchritteForm.myPlugin.rowType}" />
				<div class="col-sm-12">
					<!--                 <div class="#{NavigationForm.uiStatus.gei_imagearea == 'hide' ? 'col-sm-12' : 'col-sm-7'}"> -->
					<div class="box box-color box-bordered">
						<div class="box-title">
							<h3>
								<i class="fa fa-cog box-icon-fix"></i>
								<h:outputText value="#{myPageTitle}" />
							</h3>
							<div class="actions">
								<h:commandLink styleClass="btn btn-mini" rendered="#{NavigationForm.uiStatus.gei_description == 'tab5'}"
									action="#{NavigationForm.Reload}"
									title="#{NavigationForm.uiStatus.gei_showDetails eq 'down'?msgs.showBoxDetailsOff:msgs.showBoxDetailsOn}">
									<i
										class="fa #{NavigationForm.uiStatus.gei_showDetails eq 'down'?'fa-angle-up':'fa-angle-down'}" />
									<f:setPropertyActionListener
										target="#{NavigationForm.uiStatus.gei_showDetails}"
										value="#{NavigationForm.uiStatus.gei_showDetails eq 'down'?'up':'down'}" />
									<f:ajax render=":myform" execute=":myform" onevent="renderInputFields"/>
								</h:commandLink>
							</div>
							<ul class="tabs">
								<h:panelGroup rendered="#{LoginForm.hasRole('Plugin_Gei_WorldViews_Member')}">
									<li
										class="#{(NavigationForm.uiStatus.gei_description eq '' || NavigationForm.uiStatus.gei_description == null) ?'active':''}">
										<h:commandLink action="#{NavigationForm.Reload}"
											value="#{msgs.bibliographicData2}">
											<f:setPropertyActionListener
												target="#{NavigationForm.uiStatus.gei_description}" value="" />
											<f:setPropertyActionListener value=""
												target="#{NavigationForm.uiStatus.gei_imagearea}" />
											<f:ajax render=":myform" execute=":myform" onevent="renderInputFields"/>
										</h:commandLink>
									</li>
	
									<li
										class="#{NavigationForm.uiStatus.gei_description eq 'tab3'?'active':''}">
										<h:commandLink action="#{NavigationForm.Reload}"
											value="#{msgs.imageData}">
											<f:setPropertyActionListener
												target="#{NavigationForm.uiStatus.gei_description}"
												value="tab3" />
											<f:setPropertyActionListener value="hide"
												target="#{NavigationForm.uiStatus.gei_imagearea}" />
											<f:ajax render=":myform" execute=":myform" onevent="renderInputFields"/>
										</h:commandLink>
									</li>
								</h:panelGroup>
								<li
									class="#{NavigationForm.uiStatus.gei_description eq 'tab4'?'active':''}">
									<h:commandLink action="#{NavigationForm.Reload}"
										value="#{msgs.indexingData}">
										<f:setPropertyActionListener
											target="#{NavigationForm.uiStatus.gei_description}"
											value="tab4" />
										<f:setPropertyActionListener value="hide"
											target="#{NavigationForm.uiStatus.gei_imagearea}" />
										<f:ajax render=":myform" execute=":myform" onevent="renderInputFields" />
									</h:commandLink>
								</li>
								<li
									class="#{NavigationForm.uiStatus.gei_description eq 'tab5'?'active':''}">
									<h:commandLink action="#{NavigationForm.Reload}"
										value="#{msgs.transcriptionData}">
										<f:setPropertyActionListener
											target="#{NavigationForm.uiStatus.gei_description}"
											value="tab5" />
										<f:setPropertyActionListener value=""
											target="#{NavigationForm.uiStatus.gei_imagearea}" />
										<f:ajax render=":myform" execute=":myform" onevent="renderInputFields" />
									</h:commandLink>
								</li>
							</ul>
						</div>

						<div class="box-content nopadding">

							<h:panelGroup
								rendered="#{(NavigationForm.uiStatus.gei_description == '' || NavigationForm.uiStatus.gei_description == null)}">
								
								<h:outputText rendered="#{!LoginForm.hasRole('Plugin_Gei_WorldViews_Member')}" 
									styleClass="alert alert-danger alert-dismissable margin-sides-10 margin-bottom-10 margin-top-10"
									value="#{msgs.plugin_Gei_WorldViews_selectAnotherTab}"/>
								
								<h:panelGroup styleClass="nopadding border-right-light col-sm-7" rendered="#{LoginForm.hasRole('Plugin_Gei_WorldViews_Member')}">
									<ui:include src="includes/gei/description_metadata.xhtml" />
								</h:panelGroup>
								<h:panelGroup class="col-sm-5" rendered="#{LoginForm.hasRole('Plugin_Gei_WorldViews_Member')}">
									<ui:include src="includes/gei/description_metadata_image.xhtml" />
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup
								rendered="#{NavigationForm.uiStatus.gei_description == 'tab3'}"
								styleClass="nopadding border-right-light col-sm-12">
								<ui:include src="includes/gei/description_gallery.xhtml" />
							</h:panelGroup>

							<h:panelGroup
								rendered="#{NavigationForm.uiStatus.gei_description == 'tab4'}"
								styleClass="nopadding border-right-light col-sm-12}">
								<ui:include src="includes/gei/description_description.xhtml" />
							</h:panelGroup>

							<h:panelGroup id="mytab5"
								rendered="#{NavigationForm.uiStatus.gei_description == 'tab5'}"
								styleClass="nopadding border-right-light col-sm-12">
								<ui:include src="includes/gei/description_transcription.xhtml" />
							</h:panelGroup>

						</div>

					</div>
				</div>
			</div>

			<h:panelGroup layout="block"
				rendered="#{NavigationForm.uiStatus.gei_description == 'tab4'}"
				class="row" id="topicarea">
				<ui:include src="includes/gei/description_topics.xhtml" />
			</h:panelGroup>


			<h:panelGroup layout="block"
				rendered="#{NavigationForm.uiStatus.gei_description == 'tab4'}"
				class="row" id="secondtopicarea">
				<ui:include src="includes/gei/description_topics2.xhtml" />
			</h:panelGroup>



			<div class="row">

				<div class="form-actions">

					<!-- Save -->
					<h:commandLink
						styleClass="btn btn-success submitOnEnter pull-right margin-bottom-most font-size-s"
						id="absenden" action="#{AktuelleSchritteForm.myPlugin.save}"
						disabled="#{AktuelleSchritteForm.myPlugin.displayMode == 'category' || AktuelleSchritteForm.myPlugin.displayMode == 'keyword'}">
						<i class="fa fa-save margin-right-5"></i>
						<h:outputText value="#{msgs.speichern}" />
					</h:commandLink>

					<!-- Cancel -->

					<h:commandLink
						styleClass="btn margin-sides-10 pull-right font-size-s"
						action="#{AktuelleSchritteForm.myPlugin.cancel}"
						value="#{msgs.abbrechen}"
						disabled="#{AktuelleSchritteForm.myPlugin.displayMode == 'category' || AktuelleSchritteForm.myPlugin.displayMode == 'keyword'}" />
				</div>
			</div>
			<!-- Modal -->
			<ui:include src="includes/gei/description_gnd.xhtml" />

			<!-- geonames modal -->
			<ui:include src="includes/gei/description_geonames.xhtml" />

		</h:form>

		<script type="text/javascript">
			var simpleTinyMceConfig = {
				selector : '.editor',
				setup : function(editor) {
					editor.on('change', function() {
						tinymce.triggerSave();
					});
				},
				valid_elements : 'p',
				statusbar : true,
				theme : 'modern',
				height : 300,
				plugins : [
						'advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker',
						'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
						'save table contextmenu directionality emoticons template paste textcolor' ],
				content_css : 'css/content.css',
				toolbar : 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor',
				init_instance_callback : function(editor) {
					//						console.log("Editor: " + editor.id + " is now initialized.");
					var readOnlyAttr = $("#" + editor.id.replace(":", "\\:"))
							.attr("readonly");
					if (readOnlyAttr === "readonly") {
						editor.setMode("readonly");
					}
					try {
						resizeReferenceFields();
						$(editor.getWin()).bind('resize', function() {
							resizeReferenceFields();
						});
					} catch (error) {
					}
				},
				setup : function(editor) {
					editor.on("blur", function(event, a, b) {
						editor.save();
						$("#" + editor.id.replace(":", "\\:"))
								.trigger("change");
					});
				}

			};

			var extendedTinyMceConfig = {
				selector : '.editor_extended',
				setup : function(editor) {
					editor.on('change', function() {
						tinymce.triggerSave();
					});
				},
				invalid_elements : 'span',
				statusbar : true,
				theme : 'modern',
				height : 300,
				plugins : [
						'advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker',
						'searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking',
						'save table contextmenu directionality emoticons template paste textcolor' ],
				content_css : 'css/content.css',
				toolbar : 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor',
				init_instance_callback : function(editor) {
					//						console.log("Editor: " + editor.id + " is now initialized.");
					var readOnlyAttr = $("#" + editor.id.replace(":", "\\:"))
							.attr("readonly");
					if (readOnlyAttr === "readonly") {
						editor.setMode("readonly");
					}
					try {
						resizeReferenceFields();
						$(editor.getWin()).bind('resize', function() {
							resizeReferenceFields();
						});
					} catch (error) {
					}
				},
				setup : function(editor) {
					editor.on("blur", function(event, a, b) {
						editor.save();
						$("#" + editor.id.replace(":", "\\:"))
								.trigger("change");
					});
				}

			};

			function renderInputFields(ajaxData) {
				if (ajaxData === undefined || ajaxData.status == "begin") {
					for (edId in tinyMCE.editors)
						try {
							tinyMCE.editors[edId].remove();
							console.log("Removed editor " + edId);
						} catch (error) {
							console.log(
									"Error occured during removing editors; ",
									error);
						}
				}
				if (ajaxData === undefined || ajaxData.status == "success") {
					initTinyMce(ajaxData);
					resizeReferenceFields();
				}
			}

			function initTinyMce() {
				console.log("Init tinyMce");
				tinymce.init(simpleTinyMceConfig);
				tinymce.init(extendedTinyMceConfig);
			}

			$(window).on("load", function() {
				renderInputFields()
				$(".currentLanguage .inner-form").on("resize", function() {
					console.log('resize triggered !');
					resizeReferenceFields();
				})
			})

			function resizeReferenceFields(ajaxData) {
				if (ajaxData === undefined || ajaxData.status == "success") {
					$(".currentLanguage .form-group")
							.each(
									function(index, element) {
										var $ref = $(".referenceLanguage .form-group:eq("
												+ index + ")");
										var refHeight = $ref.height();
										$ref.outerHeight($(element)
												.outerHeight());
									})
				}
			}
		</script>

	</ui:define>
</ui:composition>